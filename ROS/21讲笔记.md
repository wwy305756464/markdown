# 基本概念

## 节点与节点管理器

### 节点（Node）- 执行单元

 * 节点是执行具体任务的进程，独立进行的可执行文件，类似于windows中的exe文件
   	* 比如说用一个controller来控制一个机器人，那么controller和机器人就是两个节点
* 不同节点可使用不同的编程语言，可以分布式运行在不同的主机上
* 节点中存在的内容可多可少，要完成的功能也是可多可少
* 节点在系统中的名称必须是唯一的

### 节点管理器（ROS Master）- 控制中心

* 为节点提供命名和注册服务
* 跟踪和记录话题/服务通信，来辅助节点互相查找，建立连接
* 提供参数服务器，节点使用此服务器来储存和检索运行时的参数
  * 这里参数服务器是一个储存全局变量的字典，存储着变量名和变量值

<img src="C:\Users\Wenyue Wang\AppData\Roaming\Typora\typora-user-images\image-20200629163127868.png" style="zoom: 50%;" />

在上面的过程中，如果各个node之间需要通信，那么需要一个控制中心，各个节点需要去找ROS master去做注册，比如告诉这个master自己需要做些什么事情。这样子ROS Master会记录下各个节点的信息。所以节点之间是不知道彼此的存在的，都需要ROS Master来帮助他们建立连接

## 话题通信 - 单向异步的信息传递

### 话题（Topic）- 异步通信机制（传递的管道）

* 节点之间用来传续数据的重要总线
* 使用发布/订阅模型，数据由发布者传输给订阅车，同一个话题的订阅者或者发布者可以不唯一

### 消息（Message）- 话题数据

* 具有一定的类型和数据结构，包括ROS提供的标准类型和用户的自定义类型
* 自定义类型可以使用与编程语言无关的 .msg 文件定义，编译过程中会生成对应的头文件，然后include在程序中

<img src="C:\Users\Wenyue Wang\AppData\Roaming\Typora\typora-user-images\image-20200629163857935.png" style="zoom:68%;" />

这里camera节点作为发布者把数据发布出去，发出去的管道叫做image_data，这个管道中传输的内容（图像的RGB值）叫做Message。

## 服务通信 - 双向同步的信息传递

与上述的话题通信不同的是，服务通信是客户端向服务端发送信息传递申请，服务端收到后执行，并且给客户端传回反馈

### 服务（Service）- 同步通信机制

* 使用客户端/服务器（C/S）模型，客户端发送请求数据，服务器完成处理后返回应答数据
* 使用编程语言无关的 .srv 文件来定义请求和应答数据结构，编译过程中生成对应的代码文件作为头文件

<img src="C:\Users\Wenyue Wang\AppData\Roaming\Typora\typora-user-images\image-20200629164346325.png" alt="image-20200629164346325" style="zoom:67%;" />

这里image processing节点向camera节点发出一个请求，比如说更改相机的清晰度。那么这么node向其发送一个七个球，camera接收并修改后，回复这个请求。但是这个往复的过程只用发生一次

## 话题 vs. 服务

<img src="C:\Users\Wenyue Wang\AppData\Roaming\Typora\typora-user-images\image-20200629180602645.png" alt="image-20200629180602645" style="zoom: 40%;" />

* 缓冲区：publisher和subscriber的速度不一致，所以需要缓冲区

## 参数（Parameter）- 全局共享字典

* 可通过网络访问的共享、多变量字典
* 节点使用此服务器来储存和检索运行时的参数
* 适合存储静态、非二进制的配置参数，不适合存储动态配置的数据

* 对于动态参数，有动态参数配置的高级功能

## 文件系统

### 功能包（Package）

- ROS软件中的基本单元，包含节点源码，配置文件，数据定义等

### 功能包清单（Package manifest）

* 记录功能包的基本信息，包含作者信息，许可信息，依赖选项，编译标志等

### 元功能包（Meta Package）

* 组织多个用于同一目的的功能包
* 一个元功能包可以包括多个功能包



# 命令行工具

![image-20200629210157638](C:\Users\Wenyue Wang\AppData\Roaming\Typora\typora-user-images\image-20200629210157638.png)

`roscore` 启动ROS Master

`rosrun 功能包名 功能包中的节点名` 用于运行某个功能包中的节点的指令

`rqt-graph` rqt是基于qt的可视化工具，用于看到系统的全貌，比如整个通信机制的计算图

`rosnode` 用来显示系统中所有节点的相关信息

​	`rosnode list` 用于显示系统中的所有节点，这里会默认多出来一个叫“rosout”的节点，默认启动话题，即只要	启动了roscore就会出现这个节点

​	`rosnode info 节点名` 显示某个节点的信息

​		`>> Publication:` 显示这个节点正在发布的话题

​		`>> Subscription:` 显示这个节点正在订阅的话题

​		`>> Services:` 显示这个节点可以提供的服务

`rostopic` 用来显示系统中多有跟话题有关的信息

​	`rostopic list` 打印当前系统中所有的话题列表

​	`rostopic pub 话题名 要发布的信息结构 “消息中的具体数据”` 发布消息，但当前消息只发布一次

​	`rostopic pub -r rate 话题名 要发布的信息结构 “消息中的具体数据”` 发布消息，以每秒rate次的频率发消息

`rosmsg` 跟发布的消息相关

​	`rosmsg show 话题名` 显示在话题中要发布消息的数据结构

`rosservice` 跟服务相关

​	`rosservice list` 显示当前提供的所有服务

​	`rosservice call /spawn 服务类型/数据 名字` ENTER之后会返回一行名字，代表request这个服务后得到的反馈

`rosbag` 话题记录工具，记录当前所有话题数据

​	`rosbag record -a -O cmd-record` 记录数据，把所有东西保存成cmd-record这个压缩包

​	`rosbag play cmd-record.bag` 播放之前录制好的数据



# 创建工作空间与功能包

## 工作空间介绍

工作空间（workspace）- 存放工程开发相关文件的文件夹，包含如下内容：

​	src: 代码空间（source space）用于放置所有的功能包

​	build: 编译空间（build space）用于放置编译过程中产生的一些中间文件

​	devel: 开发空间（development space）用于放置生成的一些可执行文件，脚本，库之类的

​	install: 安装空间 （install space）用install指令安装成功的一些结果是放在这里的，即安装的目标位置

​			在ROS2中install和devel合并并且只保留了install



## 创建工作空间的相关流程

**创建工作空间**

​	`$ mkdir -p ~/catkin_ws/src`

​	`$ cd ~/catkin_ws/src`

​	`catkin_init_workspace` 把当前文件夹初始化成有ROS属性的

**编译工作空间**

​	`cd ~/catkin_ws`

​	`catkin_make` 编译，编译src下面的所有文件，结果会放到devel和build中

​		`catkin_make install` 编译产生install这个空间

**设置环境变量**

​	`source devel/setup.bash` 

**检查环境变量**

​	`echo $ROS_PACKAGE_PATH` 显示所有工作空间的路径



## 创建功能包的相关流程

源码的最小单位是功能包，所以所有文件都必须放在功能包中，而不能放在元功能包中

创建功能包

​	`cd ~/catkin_ws/src`

​	`catkin_create_pkg <package_name> [depend1] [depend2] [depend3]`

​		这里package_name是要创建的功能包名字，depend是这个功能包在编译时需要依赖的ROS中的其他功能包

编译功能包

​	`cd ~/catkin_ws`

​	`catkin_make`

​	`source ~/catkin_ws/devel/setup.bash` 设置环境变量

在同一工作空间下，不允许存在同名功能包。在不同工作空间下，允许存在同名功能包



# Publisher的编程实现



​	

​	